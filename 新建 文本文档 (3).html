```html
<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>简单视频网站（MVP）</title>
  <style>
    body { font-family: Arial, sans-serif; max-width:900px; margin: 20px auto; padding:0 16px; }
    header { display:flex; justify-content:space-between; align-items:center; }
    video { max-width:100%; height:auto; background:#000; }
    .video-item { margin: 12px 0; padding:8px; border:1px solid #eee; border-radius:6px; }
    form { margin:12px 0; }
  </style>
</head>
<body>
  <header>
    <h1>简单视频网站（MVP）</h1>
    <div><small>本地演示 - Node.js + Express</small></div>
  </header>

  <section>
    <h2>上传视频（仅允许 mp4 / webm / ogg / mov）</h2>
    <form id="uploadForm" method="post" action="/upload" enctype="multipart/form-data">
      <input type="file" name="video" accept="video/*" required />
      <button type="submit">上传</button>
    </form>
  </section>

  <section>
    <h2>视频列表</h2>
    <div id="videos">正在加载…</div>
  </section>

  <template id="tpl">
    <div class="video-item">
      <div><strong class="name"></strong> <small class="size"></small></div>
      <video controls preload="metadata">
        <source class="src" type="video/mp4" />
        你的浏览器不支持 video 标签。
      </video>
    </div>
  </template>

  <script>
    function formatSize(n) {
      if (n < 1024) return n + ' B';
      if (n < 1024*1024) return (n/1024).toFixed(1) + ' KB';
      if (n < 1024*1024*1024) return (n/1024/1024).toFixed(1) + ' MB';
      return (n/1024/1024/1024).toFixed(2) + ' GB';
    }

    async function load() {
      try {
        const res = await fetch('/api/videos');
        const list = await res.json();
        const container = document.getElementById('videos');
        container.innerHTML = '';
        if (list.length === 0) container.textContent = '暂无视频，先上传一个试试。';
        list.forEach(v => {
          const tpl = document.getElementById('tpl').content.cloneNode(true);
          tpl.querySelector('.name').textContent = v.name;
          tpl.querySelector('.size').textContent = formatSize(v.size);
          const src = tpl.querySelector('.src');
          src.src = v.url; // /video/<filename>
          // set type dynamically based on filename extension
          const ext = v.name.split('.').pop().toLowerCase();
          if (ext === 'webm') src.type = 'video/webm';
          else if (ext === 'ogg' || ext === 'ogv') src.type = 'video/ogg';
          else if (ext === 'mov') src.type = 'video/quicktime';
          else src.type = 'video/mp4';
          container.appendChild(tpl);
        });
      } catch (err) {
        document.getElementById('videos').textContent = '加载失败：' + err;
      }
    }

    load();
    // optional: refresh after upload
    document.getElementById('uploadForm').addEventListener('submit', () => {
      setTimeout(load, 1200);
    });
  </script>
</body>
</html>

